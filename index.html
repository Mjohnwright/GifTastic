<head>
  <meta charset="utf-8">
  <title>Stop: It's Giphy time</title>
  <!-- Added link to the jQuery Library -->

</head>


<body>
  <div id="cityArray">

  </div>

  <br>
  <form id="city-form">
    <label for="city" input="text">Add a city</label>
    <input type="text" id="city-input"></input>

    <input id="addCity" type="submit" value="submit">
    </br>
  </form>


  <div id="city">

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- JAVASCRIPT -->
  <script type="text/javascript">
    /* *******************************
                            VARIABLES               
                    ********************************* */


    // City Array
    var cityGiphy = ["London", "Mexico City", "Quebec", "Copenhagen", "Prague", "Cairo",
      "Constantinople", "Tokyo", "Budapest", "Reykjavik", "Tehran", "Seoul", "Berlin"
    ];
    // Not sure if I need this
    var results;

    // For each city in the array, creating a button
    $.each(cityGiphy, function (i, val) {

      var cityButton = $("<button>" + val + "</button>");


      // Writing the button name on the DOM
      $("#cityArray").append(cityButton);
    })

    //SEARCH BUTTON FUNCTIONALITY****************************************************************
    //  Using submit button to add the the cityArray
    $("#addCity[type='submit']").on("click", function (event) {

      event.preventDefault();


      // document.forms["myForm"].reset();
      // document.getElementById("input[type='text']").reset();
      // document.getElementById("input").reset();
      // $("#city-input").resetForm()

      var newCity = $("input[type='text']").val().trim();

      $("#cityArray").append("<button>" + newCity + "</button>");
      $("#addcity[type='text']").val("");


    })

    // ARRAY FUNCTIONALITY**********************************************************************
    // When user clicks a button on the array it launches runGiphy function
    $(document).on("click", "button", function () {
      // var buttonValue = $(this).html();
      var buttonValue = $(this).html();

      console.log(buttonValue);
      runGiphy(buttonValue);

    })

    /* *******************************
             FUNCTIONS               
     ********************************* */


    // FUNCTION runGiphy
    function runGiphy(buttonValue) {

      //Empties out the the gifs that were already loaded
      $("#city").empty(); // empties out the html


      // query set to search for CITY + API key + limit to 10 responses
      var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
        buttonValue + "&api_key=5buFvdZ3WSNHFzbFytMWBbjytoPx7bbD&limit=10";

      // Launch the API query using the URL from above
      $.ajax({
          url: queryURL,
          method: "GET"
        })
        //Promise from the Giphy
        .then(function (response) {
          console.log(response);
          //creating a variable from the API response
          results = response.data;
          console.log(results);
          // Looping through each result item (REQUESTED 10 ITEMS)
          for (var i = 0; i < results.length; i++) {

            var cityDiv = $("<div>");

            // Creating a paragraph tag with the result item's rating
            var p = $("<p>").text("Rating: " + results[i].rating);

            // Creating and storing an image tag
            var cityStillImage = $("<img>");
            // Setting the src attribute of the image to a property pulled off the result item
            cityStillImage.attr("src", results[i].images.fixed_height_still.url);

            // Appending the paragraph and image tag to the cityDiv
            cityDiv.append(p);
            cityDiv.append(cityStillImage);
            console.log(cityDiv);
            // Prependng the cityDiv to the HTML page in the "#city" div
            $("#city").prepend(cityDiv);

            //ANIMATE THE GIF
            $(document).on("click", "img", function () {
              console.log("click");
              var cityAnimateImage = $("<img>");
              cityAnimateImage.attr("src", results.images.fixed_height.url);
              cityDiv.append(cityAnimateImage);
            })
          }
        })

    } 
  </script>
</body>

</html>


<!-- API key for Giphy: 5buFvdZ3WSNHFzbFytMWBbjytoPx7bbD -->
<!-- //  .val() is used to get value from an input -->